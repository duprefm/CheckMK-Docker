# CheckMK-Docker
## Modifiction de la configuration reseau
    $ cat /etc/resolv.conf
    # This file was automatically generated by WSL. To stop automatic generation of this file, add the following entry to /etc/wsl.conf:
    # [network]
    # generateResolvConf = false
    #nameserver 172.17.124.97
    nameserver 8.8.8.8''''''

## Generation d'une clef ssh pour connexion au git
    $ ssh-keygen -t ed25519 -C "duprefm@gmail.com"
    $ ssh -T git@github.com

## Premier push et configuration de la communication entre le poste de travail et le GIT
    $ cd Github/CheckMK-Docker
    echo "# CheckMK-Docker" >> README.md
    git init
    git add README.md
    git commit -m "first commit"
    git branch -M main
    git remote add origin https://github.com/duprefm/CheckMK-Docker.git
    git remote set-url origin git@github.com:duprefm/CheckMK-Docker.git
    git push -u origin main

## Gestion du moteur Docker Demarrage Verification du status Arret
    $ sudo service docker start
    $ sudo service docker status
    $ sudo service docker stop

## Recuperer la dernière version de l'image
    docker pull checkmk/check-mk-raw:2.0.0-latest

## Demarrage de l'application
    $ docker-compose up -d

## Arret de l'application
    $ docker-compose stop

## Vérifier si le container a démarré
    $ docker ps

## Récupérer le mot de passe CheckMK
    $ docker logs monitoring

## Se connecter au container monitoring
    $ docker exec -it monitoring /bin/bash

## Installer l'agent au container monitoring
    $ docker exec -it monitoring /bin/bash
    # apt install check-mk-agent

- Le site est disponible a l'adresse suivante
    http://localhost:8080/cmk/check_mk/

- Le package se situe a l'endroit suivant
    /opt/omd/versions/2.0.0p30.cre/share/check_mk/agents/check-mk-agent_2.0.0p30-1_all.deb

## Installation de l'agent sur node01
    # apt update
    # apt upgrade
    # apt install wget
    # wget http://monitoring:5000/cmk/check_mk/agents/check-mk-agent_2.0.0p30-1_all.deb
    # dpkg -i check-mk-agent_2.0.0p30-1_all.deb
    # apt install ./check-mk-agent_2.0.0p30-1_all.deb

## Configuration de NSCA via omd config

### Installation nsca sur monitoring
    apt install gcc make autoconf libc-dev pkg-config libmcrypt-dev php-pear php-dev
    apt install nsca

### Aide d'utilisation de send_nsca

    Usage: send_nsca -H <host_address> [-p port] [-to to_sec] [-d delim] [-c config_file]

    Options:
     <host_address> = The IP address of the host running the NSCA daemon
     [port]         = The port on which the daemon is running - default is 5667
     [to_sec]       = Number of seconds before connection attempt times out.
                      (default timeout is 10 seconds)
     [delim]        = Delimiter to use when parsing input (defaults to a tab)
     [config_file]  = Name of config file to use


    Service Checks:
    <host_name>[tab]<svc_description>[tab]<return_code>[tab]<plugin_output>[newline]

    Host Checks:
    <host_name>[tab]<return_code>[tab]<plugin_output>[newline]

### Commade de test d'envoi vers le serveur CheckMK

    echo -e "localhost\tCheckBackupError\t0\tTEST\n" | /usr/sbin/send_nsca -H 172.18.0.3 -c /opt/omd/sites/cmk/etc/nsca/send_nsca.cfg -p 5667

## Fabriquer un container avec ports specifiques CheckMK
    docker build -t centos-node .
    docker tag centos-node:latest fabricedupre/centos-node:latest 
    docker push fabricedupre/centos-node:latest